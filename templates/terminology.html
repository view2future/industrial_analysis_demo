<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœ¯è¯­è¯å…¸ - åŒºåŸŸäº§ä¸šåˆ†æå°å·¥ä½œå°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('index') }}">ğŸ“š æœ¯è¯­è¯å…¸</a>
      <div class="ms-auto">
        <a href="{{ url_for('index') }}" class="btn btn-outline-light btn-sm">è¿”å›é¦–é¡µ</a>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2><i class="bi bi-book"></i> ä¸“ä¸šæœ¯è¯­åº“</h2>
      <div>
        <button id="btnExport" class="btn btn-sm btn-success"><i class="bi bi-download"></i> å¯¼å‡ºJSON</button>
      </div>
    </div>

    <div class="row">
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">æœç´¢æœ¯è¯­</h5>
            <input type="text" id="searchTerm" class="form-control" placeholder="è¾“å…¥æœ¯è¯­å…³é”®è¯...">
            <small class="text-muted">æ”¯æŒä¸­æ–‡ä¸è‹±æ–‡å…³é”®è¯</small>
          </div>
        </div>

        <div class="card mt-3">
          <div class="card-body">
            <h5 class="card-title">æ–°å¢æœ¯è¯­</h5>
            <div class="mb-2"><input id="newTerm" class="form-control" placeholder="æœ¯è¯­"></div>
            <div class="mb-2"><input id="newCategory" class="form-control" placeholder="ç±»åˆ«"></div>
            <div class="mb-2"><input id="newImportance" type="number" min="1" max="10" class="form-control" placeholder="é‡è¦åº¦(1-10)"></div>
            <div class="mb-2"><textarea id="newDefinition" class="form-control" placeholder="å®šä¹‰" rows="3"></textarea></div>
            <div class="mb-2"><input id="newRelated" class="form-control" placeholder="ç›¸å…³(ç”¨ä¸­æ–‡é€—å·åˆ†éš”)"></div>
            <button id="btnAddTerm" class="btn btn-primary btn-sm"><i class="bi bi-plus-circle"></i> æ·»åŠ </button>
          </div>
        </div>

        <div class="card mt-3">
          <div class="card-body">
            <h5 class="card-title">è¯é¢‘ç»Ÿè®¡</h5>
            <div id="stats"></div>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">æœ¯è¯­åˆ—è¡¨</h5>
            <div id="terms" class="list-group"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let terms = {};

    async function loadTerminology() {
      const res = await fetch('/api/terminology');
      terms = await res.json();
      renderTerms(terms);
      renderStats(terms);
    }

    function renderTerms(data) {
      const list = document.getElementById('terms');
      list.innerHTML = '';
      Object.entries(data).forEach(([word, info]) => {
        const item = document.createElement('a');
        item.className = 'list-group-item list-group-item-action';
        item.innerHTML = `
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">${word} <span class="badge bg-info">${info.category || '-'}</span></h5>
            <small>é‡è¦åº¦: ${info.importance || '-'}</small>
          </div>
          <p class="mb-1">${info.definition || ''}</p>
          <small>ç›¸å…³ï¼š${(info.related || []).join('ã€')}</small>
        `;
        list.appendChild(item);
      });
    }

    function renderStats(data) {
      const stats = document.getElementById('stats');
      const total = Object.keys(data).length;
      const categories = {};
      Object.values(data).forEach(x => { categories[x.category] = (categories[x.category] || 0) + 1; });
      stats.innerHTML = `
        <ul class="list-group">
          <li class="list-group-item d-flex justify-content-between align-items-center">
            æœ¯è¯­æ€»æ•° <span class="badge bg-primary rounded-pill">${total}</span>
          </li>
          ${Object.entries(categories).map(([k,v]) => `<li class="list-group-item d-flex justify-content-between align-items-center">${k}<span class="badge bg-secondary rounded-pill">${v}</span></li>`).join('')}
        </ul>
      `;
    }

    document.getElementById('searchTerm').addEventListener('input', function () {
      const q = this.value.trim();
      if (!q) { renderTerms(terms); return; }
      const filtered = Object.fromEntries(Object.entries(terms).filter(([k]) => k.includes(q)));
      renderTerms(filtered);
    });

    document.getElementById('btnExport').addEventListener('click', function () {
      const blob = new Blob([JSON.stringify(terms, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'terminology.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    document.getElementById('btnAddTerm').addEventListener('click', async function () {
      const term = document.getElementById('newTerm').value.trim();
      if (!term) return;
      const info = {
        category: document.getElementById('newCategory').value.trim() || 'æœªåˆ†ç±»',
        importance: Number(document.getElementById('newImportance').value) || 5,
        definition: document.getElementById('newDefinition').value.trim() || '',
        related: (document.getElementById('newRelated').value.trim() || '').split('ï¼Œ').filter(Boolean)
      };
      await fetch('/api/terminology', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ term, info }) });
      await loadTerminology();
    });

    loadTerminology();
  </script>
</body>
</html>
